<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Timebox Planner</title>

  <!-- PWA -->
  <link rel="manifest" href="./manifest.webmanifest" />
  <meta name="theme-color" content="#4f46e5" />

  <style>
    :root{
      --primary:#4f46e5;
      --primary-2:#6d28d9;
      --bg:#f4f6fb;
      --card:#ffffff;
      --text:#0f172a;
      --muted:#64748b;
      --border:#e6e8f0;
      --shadow:0 10px 24px rgba(15,23,42,.08);
      --shadow-soft:0 6px 18px rgba(15,23,42,.06);
      --radius:22px;
      --radius-sm:16px;
      --danger:#ef4444;
      --danger-bg:#ffe4e6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:var(--bg);
      color:var(--text);
    }
    .wrap{
      max-width: 720px;
      margin: 0 auto;
      padding: 14px 14px 64px;
    }

    /* ===== Top quote (ìŠ¤í¬ìƒ· ëŠë‚Œ: ê¹”ë”í•œ ìƒë‹¨ ì„¹ì…˜) ===== */
    .topQuote{
      background:#fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px 16px 14px;
      border:1px solid rgba(0,0,0,.03);
    }
    .brandRow{
      display:flex;
      align-items:center;
      gap:12px;
      margin-bottom: 10px;
    }
    .brandIcon{
      width:44px;height:44px;
      border-radius: 14px;
      background: linear-gradient(135deg, rgba(79,70,229,.14), rgba(109,40,217,.14));
      display:flex;align-items:center;justify-content:center;
      font-size: 24px;
    }
    .brandTitle{
      font-size: 28px;
      font-weight: 900;
      letter-spacing: -.4px;
      color: var(--primary);
      margin:0;
      line-height:1.05;
    }
    .brandSub{
      margin: 4px 0 0;
      color: var(--muted);
      font-weight: 700;
    }
    .quoteLine{
      margin-top: 12px;
      background: linear-gradient(90deg, var(--primary), var(--primary-2));
      color:#fff;
      padding: 12px 14px;
      border-radius: 18px;
      text-align:center;
      font-weight: 900;
      box-shadow: var(--shadow-soft);
    }

    /* ===== Date + nav ===== */
    .dateBlock{
      margin-top: 14px;
      background:#fff;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      border:1px solid rgba(0,0,0,.03);
    }
    .dateRow{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
    }
    .dateTitle{
      font-size: 22px;
      font-weight: 900;
      letter-spacing:-.2px;
    }
    .calBtn{
      border:none;
      background: rgba(79,70,229,.10);
      color: var(--primary);
      width: 44px;height: 44px;
      border-radius: 14px;
      cursor:pointer;
      display:flex;align-items:center;justify-content:center;
      font-size: 20px;
      font-weight:900;
    }
    .navRow{
      display:flex;
      justify-content:space-between;
      margin-top: 12px;
    }
    .navBtn{
      border:none;
      width: 58px;
      height: 46px;
      border-radius: 14px;
      background: var(--primary);
      color:#fff;
      font-size: 18px;
      font-weight: 900;
      cursor:pointer;
      box-shadow: var(--shadow-soft);
    }

    /* ===== Cards ===== */
    .card{
      background:var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 14px;
      margin-top: 14px;
      border:1px solid rgba(0,0,0,.03);
    }
    .cardHeader{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 12px;
    }
    .cardTitle{
      margin:0;
      display:flex;
      align-items:center;
      gap:10px;
      font-size: 18px;
      font-weight: 900;
      letter-spacing:-.2px;
    }
    .titleIcon{
      width: 34px;height: 34px;
      border-radius: 12px;
      background: rgba(79,70,229,.10);
      display:flex;align-items:center;justify-content:center;
      color: var(--primary);
      font-weight: 900;
    }

    /* ===== TO DO ===== */
    .plusBtn{
      border:none;
      width: 40px;height: 40px;
      border-radius: 14px;
      background:#111827;
      color:#fff;
      font-size: 24px;
      line-height: 40px;
      cursor:pointer;
      box-shadow: var(--shadow-soft);
    }

    .todoList{
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .todoItem{
      display:flex;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background:#fff;
    }
    .checkBox{
      width: 24px;height: 24px;
      border-radius: 8px;
      border: 2px solid var(--primary);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;
      flex:0 0 auto;
      font-weight: 900;
      color:#fff;
      background:#fff;
    }
    .checkBox.done{
      background: var(--primary);
    }
    .todoInput{
      border:none;
      outline:none;
      width:100%;
      font-size: 16px;
      font-weight: 800;
      background:transparent;
      color: var(--text);
    }
    .todoInput::placeholder{
      color:#9aa4b2;
      font-weight:800;
    }
    .todoInput.done{
      text-decoration: line-through;
      color:#94a3b8;
      font-weight: 800;
    }
    .trashBtn{
      border:none;
      width: 40px;height: 40px;
      border-radius: 14px;
      background: var(--danger-bg);
      color: var(--danger);
      cursor:pointer;
      flex:0 0 auto;
      display:flex;align-items:center;justify-content:center;
      font-size: 18px;
      font-weight: 900;
    }

    /* ===== Brain Dump ===== */
    textarea{
      width:100%;
      min-height: 190px;
      border: 2px solid #e9edf6;
      border-radius: 18px;
      padding: 14px;
      font-size: 16px;
      font-weight: 700;
      outline:none;
      resize: vertical;
      background:#fff;
    }
    textarea::placeholder{ color:#9aa4b2; font-weight:800; }

    /* ===== Calendar Modal ===== */
    .modalBg{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.45);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
      z-index: 999;
    }
    .modal{
      width:min(420px, 100%);
      background:#fff;
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 14px;
    }
    .modalTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .modalTop b{font-size:18px; font-weight: 900;}
    .miniBtn{
      border:none;
      background:#f1f5f9;
      width: 42px;height: 42px;
      border-radius: 14px;
      cursor:pointer;
      font-size: 18px;
      font-weight:900;
    }
    .weekRow, .grid{
      display:grid;
      grid-template-columns: repeat(7, 1fr);
      gap:8px;
    }
    .weekRow div{
      text-align:center;
      font-size:12px;
      color: var(--muted);
      font-weight:900;
      padding: 6px 0;
    }
    .dayBtn{
      border:none;
      background:#fff;
      border-radius: 14px;
      padding: 10px 0;
      cursor:pointer;
      border:1px solid var(--border);
      font-weight: 900;
      position:relative;
    }
    .dayBtn.today{border-color: var(--primary); color: var(--primary);}
    .dayBtn.selected{background: var(--primary); color:#fff; border-color: var(--primary);}
    .dot{
      position:absolute;
      bottom:6px;
      left:50%;
      transform:translateX(-50%);
      width:6px;height:6px;border-radius:999px;
      background: var(--primary);
      opacity:.85;
    }
    .dayBtn.selected .dot{ background:#fff; opacity:1; }
    .empty{visibility:hidden}
    .closeWide{
      width:100%;
      margin-top: 10px;
      border:none;
      background:#f1f5f9;
      padding: 12px;
      border-radius: 16px;
      cursor:pointer;
      font-weight:900;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- TOP: íƒ€ì´í‹€ + ë™ê¸°ë¶€ì—¬ ë¬¸êµ¬ -->
    <div class="topQuote">
      <div class="brandRow">
        <div class="brandIcon">ğŸ•’</div>
        <div>
          <h1 class="brandTitle">Timebox Planner</h1>
          <p class="brandSub">Timeboxing your day.</p>
        </div>
      </div>
      <div class="quoteLine" id="quoteLine">ì˜¤ëŠ˜ í•˜ë£¨ë„ ìµœì„ ì„ ë‹¤í•´ë´ìš”! ğŸ’ª</div>
    </div>

    <!-- ë‚ ì§œ + ì´ë™ + ë‹¬ë ¥ -->
    <div class="dateBlock">
      <div class="dateRow">
        <button class="calBtn" id="openCalendar" title="ë‹¬ë ¥">ğŸ“…</button>
        <div class="dateTitle" id="dateTitle">1ì›” 14ì¼ (ìˆ˜)</div>
      </div>
      <div class="navRow">
        <button class="navBtn" id="prevDay">â—€</button>
        <button class="navBtn" id="nextDay">â–¶</button>
      </div>
    </div>

    <!-- TO DO LIST -->
    <div class="card">
      <div class="cardHeader">
        <h3 class="cardTitle">
          <span class="titleIcon">â‰¡</span>
          TO DO LIST
        </h3>
        <button class="plusBtn" id="addTodo" title="ì¶”ê°€">+</button>
      </div>
      <div class="todoList" id="todoList"></div>
    </div>

    <!-- BRAIN DUMP -->
    <div class="card">
      <div class="cardHeader" style="margin-bottom:10px;">
        <h3 class="cardTitle">
          <span class="titleIcon">ğŸ§ </span>
          BRAIN DUMP
        </h3>
      </div>
      <textarea id="brainDump" placeholder="ìƒê°ì„ ììœ ë¡­ê²Œ ì ì–´ë³´ì„¸ìš”."></textarea>
    </div>

  </div>

  <!-- ë‹¬ë ¥ ëª¨ë‹¬ -->
  <div class="modalBg" id="modalBg">
    <div class="modal">
      <div class="modalTop">
        <button class="miniBtn" id="calPrev">â—€</button>
        <b id="calTitle">2026ë…„ 1ì›”</b>
        <button class="miniBtn" id="calNext">â–¶</button>
      </div>

      <div class="weekRow">
        <div>ì¼</div><div>ì›”</div><div>í™”</div><div>ìˆ˜</div><div>ëª©</div><div>ê¸ˆ</div><div>í† </div>
      </div>
      <div class="grid" id="calGrid"></div>

      <button class="closeWide" id="calClose">ë‹«ê¸°</button>
    </div>
  </div>

  <script>
    // ===== Service Worker (ì´ë¯¸ sw.jsê°€ ìˆë‹¤ë©´ ê·¸ëŒ€ë¡œ ì‚¬ìš©) =====
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("./sw.js").catch(()=>{});
    }

    // ===== ì €ì¥ í‚¤ =====
    const STORAGE_KEY = "timeboxPlanner_v2";

    // ===== ìƒíƒœ =====
    let dailyData = {};
    let selectedDate = new Date();
    let calendarMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);

    const motivationalQuotes = [
      "ì˜¤ëŠ˜ í•˜ë£¨ë„ ìµœì„ ì„ ë‹¤í•´ë´ìš”! ğŸ’ª",
      "ì‘ì€ ì§„ì „ë„ ì§„ì „ì…ë‹ˆë‹¤! ğŸŒŸ",
      "ë‹¹ì‹ ì€ í•  ìˆ˜ ìˆì–´ìš”! âœ¨",
      "ì˜¤ëŠ˜ë„ ë©‹ì§„ í•˜ë£¨ ë˜ì„¸ìš”! ğŸ¯",
      "í•œ ê±¸ìŒ í•œ ê±¸ìŒ, ì°¨ê·¼ì°¨ê·¼! ğŸš€",
      "ë‹¹ì‹ ì˜ ë…¸ë ¥ì€ ë¹›ì„ ë°œí•  ê±°ì˜ˆìš”! ğŸ’«",
      "ì˜¤ëŠ˜ì˜ ë‹¹ì‹ ì„ ì‘ì›í•©ë‹ˆë‹¤! ğŸŒˆ",
      "ì™„ë²½í•˜ì§€ ì•Šì•„ë„ ê´œì°®ì•„ìš”! ğŸ’",
      "í•  ìˆ˜ ìˆë‹¤ëŠ” ë¯¿ìŒì´ ë°˜ì…ë‹ˆë‹¤! ğŸŒ»",
      "ì˜¤ëŠ˜ í•˜ë£¨ë¥¼ ì¦ê²¨ë´ìš”! ğŸ¨"
    ];

    const $ = (id)=>document.getElementById(id);

    function dateKey(d){
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      return `${yyyy}-${mm}-${dd}`;
    }

    function load(){
      const saved = localStorage.getItem(STORAGE_KEY);
      if(saved){
        try { dailyData = JSON.parse(saved) || {}; }
        catch { dailyData = {}; }
      }
    }
    function save(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(dailyData));
    }

    function getDayData(key){
      return dailyData[key] || { todos: [], braindump: "" };
    }

    function getTodayData(){
      const key = dateKey(selectedDate);
      return getDayData(key);
    }

    function setTodayData(next){
      const key = dateKey(selectedDate);
      dailyData[key] = next;
      save();
    }

    // ===== 1) ë™ê¸°ë¶€ì—¬ ë¬¸êµ¬ =====
    function setQuote(){
      const q = motivationalQuotes[Math.floor(Math.random()*motivationalQuotes.length)];
      $("quoteLine").textContent = q;
    }

    // ===== 2) ë‚ ì§œ í‘œì‹œ/ì´ë™ =====
    function formatKoreanDate(d){
      const days = ["ì¼","ì›”","í™”","ìˆ˜","ëª©","ê¸ˆ","í† "];
      return `${d.getMonth()+1}ì›” ${d.getDate()}ì¼ (${days[d.getDay()]})`;
    }
    function renderHeader(){
      $("dateTitle").textContent = formatKoreanDate(selectedDate);
    }

    $("prevDay").addEventListener("click", ()=>{
      selectedDate.setDate(selectedDate.getDate()-1);
      renderAll();
    });
    $("nextDay").addEventListener("click", ()=>{
      selectedDate.setDate(selectedDate.getDate()+1);
      renderAll();
    });

    // ===== 3) TO DO LIST =====
    function addTodo(){
      const data = getTodayData();
      data.todos.push({ id: Date.now(), text: "", done: false });
      setTodayData(data);
      renderTodos(true); // true => ìƒˆë¡œ ì¶”ê°€ í›„ í¬ì»¤ìŠ¤
    }

    function toggleTodo(id){
      const data = getTodayData();
      data.todos = data.todos.map(t => t.id===id ? ({...t, done: !t.done}) : t);
      // ì™„ë£Œ í•­ëª© ì•„ë˜ë¡œ ì •ë ¬
      data.todos = sortTodos(data.todos);
      setTodayData(data);
      renderTodos();
    }

    function updateTodoText(id, text){
      const data = getTodayData();
      data.todos = data.todos.map(t => t.id===id ? ({...t, text}) : t);
      setTodayData(data);
      // ì…ë ¥ ì¤‘ì—” ì „ì²´ re-renderë¥¼ ìµœì†Œí™” (ì‚¬ìš©ê° ê°œì„ )
    }

    function deleteTodo(id){
      const data = getTodayData();
      data.todos = data.todos.filter(t => t.id!==id);
      setTodayData(data);
      renderTodos();
    }

    function sortTodos(todos){
      // done=false ë¨¼ì €, done=true ë‚˜ì¤‘. ê°™ì€ ê·¸ë£¹ ë‚´ì—ì„œëŠ” ìƒì„±ìˆœ ìœ ì§€
      return [...todos].sort((a,b)=>{
        if(a.done === b.done) return a.id - b.id;
        return a.done ? 1 : -1;
      });
    }

    function renderTodos(focusNew=false){
      const list = $("todoList");
      list.innerHTML = "";

      const data = getTodayData();
      // í•­ìƒ ì •ë ¬ ìƒíƒœ ìœ ì§€
      data.todos = sortTodos(data.todos);
      setTodayData(data);

      let lastInput = null;

      data.todos.forEach(todo=>{
        const row = document.createElement("div");
        row.className = "todoItem";

        const check = document.createElement("div");
        check.className = "checkBox" + (todo.done ? " done" : "");
        check.textContent = todo.done ? "âœ“" : "";
        check.addEventListener("click", ()=>toggleTodo(todo.id));

        const input = document.createElement("input");
        input.className = "todoInput" + (todo.done ? " done" : "");
        input.placeholder = "í•  ì¼";
        input.value = todo.text || "";
        input.addEventListener("input", (e)=>updateTodoText(todo.id, e.target.value));
        input.addEventListener("blur", ()=>renderCalendar()); // ë°ì´í„° ì  í‘œì‹œ ì—…ë°ì´íŠ¸

        const trash = document.createElement("button");
        trash.className = "trashBtn";
        trash.textContent = "ğŸ—‘";
        trash.title = "ì‚­ì œ";
        trash.addEventListener("click", ()=>deleteTodo(todo.id));

        row.appendChild(check);
        row.appendChild(input);
        row.appendChild(trash);
        list.appendChild(row);

        lastInput = input;
      });

      if(focusNew && lastInput){
        lastInput.focus();
      }
    }

    $("addTodo").addEventListener("click", addTodo);

    // ===== Brain Dump =====
    $("brainDump").addEventListener("input", (e)=>{
      const data = getTodayData();
      data.braindump = e.target.value;
      setTodayData(data);
      // ë‹¬ë ¥ ì  í‘œì‹œë¥¼ ì¦‰ì‹œ ë°˜ì˜í•˜ë ¤ë©´ ì•„ë˜ ì£¼ì„ í•´ì œ
      // renderCalendar();
    });

    function renderBrainDump(){
      $("brainDump").value = getTodayData().braindump || "";
    }

    // ===== ë‹¬ë ¥: ë°ì´í„° ìˆëŠ” ë‚ ì§œ ì (â€¢) í‘œì‹œ =====
    function hasDataOnDate(key){
      const d = dailyData[key];
      if(!d) return false;
      const hasTodo = Array.isArray(d.todos) && d.todos.some(t => (t.text && t.text.trim()) || t.done);
      const hasBrain = !!(d.braindump && d.braindump.trim());
      return hasTodo || hasBrain;
    }

    // ===== Calendar Modal =====
    function openCalendar(){
      calendarMonth = new Date(selectedDate.getFullYear(), selectedDate.getMonth(), 1);
      renderCalendar();
      $("modalBg").style.display = "flex";
    }
    function closeCalendar(){
      $("modalBg").style.display = "none";
    }

    $("openCalendar").addEventListener("click", openCalendar);
    $("calClose").addEventListener("click", closeCalendar);
    $("modalBg").addEventListener("click", (e)=>{
      if(e.target.id === "modalBg") closeCalendar();
    });

    $("calPrev").addEventListener("click", ()=>{
      calendarMonth.setMonth(calendarMonth.getMonth()-1);
      renderCalendar();
    });
    $("calNext").addEventListener("click", ()=>{
      calendarMonth.setMonth(calendarMonth.getMonth()+1);
      renderCalendar();
    });

    function renderCalendar(){
      const y = calendarMonth.getFullYear();
      const m = calendarMonth.getMonth();
      $("calTitle").textContent = `${y}ë…„ ${m+1}ì›”`;

      const first = new Date(y, m, 1);
      const last = new Date(y, m+1, 0);
      const daysInMonth = last.getDate();
      const startDow = first.getDay();

      const grid = $("calGrid");
      grid.innerHTML = "";

      for(let i=0; i<startDow; i++){
        const d = document.createElement("div");
        d.className = "dayBtn empty";
        d.textContent = "0";
        grid.appendChild(d);
      }

      const todayKey = dateKey(new Date());
      const selectedKey = dateKey(selectedDate);

      for(let day=1; day<=daysInMonth; day++){
        const d = new Date(y, m, day);
        const key = dateKey(d);

        const btn = document.createElement("button");
        btn.className = "dayBtn";
        btn.textContent = String(day);

        if(key===todayKey) btn.classList.add("today");
        if(key===selectedKey) btn.classList.add("selected");

        // ë°ì´í„° ì  í‘œì‹œ
        if(hasDataOnDate(key)){
          const dot = document.createElement("div");
          dot.className = "dot";
          btn.appendChild(dot);
        }

        btn.addEventListener("click", ()=>{
          selectedDate = d;
          closeCalendar();
          renderAll();
        });

        grid.appendChild(btn);
      }
    }

    // ===== ì „ì²´ ë Œë” =====
    function renderAll(){
      renderHeader();
      renderTodos();
      renderBrainDump();
      // ë‹¬ë ¥ ëª¨ë‹¬ì´ ì—´ë ¤ìˆì„ ìˆ˜ ìˆìœ¼ë‹ˆ ì›” í‘œì‹œ/ì  ì—…ë°ì´íŠ¸ë„ ê°€ëŠ¥
      // renderCalendar();
    }

    // ì´ˆê¸°í™”
    load();
    setQuote();
    renderAll();
  </script>
</body>
</html>
